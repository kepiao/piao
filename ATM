#include<stdio.h>
#include <string.h>
#include<stdlib.h>//system("cls")（清屏）函数头文件
#include <cstdlib>//exit(0)（主函数之外退出程序）函数头文件

struct Account//定义账户
{
	char name[100];//姓名
	char idCard[19];//身份证号
	char username[100];//账号
	char password[7];//密码
	char tel[12];//手机号
	float money;//余额
};
typedef struct Account Account;

Account a[100];
int i = 0;
char accountId[20], password[20];//定义一个临时数组用于存放登录时输入的账号密码
int j = 0;
int x = 0;	


void showEnglishMenu1();//中文菜单1
void showChineseMenu1();//英文菜单1
void showChineseMenu2();//用户界面1
//用户界面2
void signIn();//登录
int findAccount();//密码判断
void signUp1();//开户（中文）
void signUp2();//开户（英文）

void qukuan();//取款
void deposit();//存款
void transfer();//转账
void balance();//余额查询
void xgmm();//修改密码
void baocun();//保存数据

int main()
{
	printf("*****************************\n");
	printf("**欢迎使用ATM自动取款机系统**\n");
	printf("*****************************\n");
	printf("——————————————\n");
	printf("|      按1,显示中文       |\n");
	printf("——————————————\n");
	printf("|    Input 2,Show English   |\n");
	printf("——————————————\n");

	char c;
	scanf_s("%c", &c, sizeof(c));
	system("cls");
	if (c == '1')
	{
		//显示中文菜单 
		showChineseMenu1();
	}
	else if (c == '2')
	{
		//显示英文菜单 
		showEnglishMenu1();
	}
	return 0;
}

//********************************************************************************************************************
//中文菜单2
void showChineseMenu2()
{
	int i;      //i为客户选择输入的变量
	while (1)
	{
		printf("请选择您需要的业务\n");      //银行业务菜单
		printf(" ——————————————————\n");
		printf(" —— 1 取款      ——2 存款     ——\n");
		printf(" ——————————————————\n");
		printf(" —— 3 转账      ——4 余额查询 ——\n");
		printf(" ——————————————————\n");
		printf(" —— 5 修改密码  ——6 退出     ——\n");
		printf(" ——————————————————\n");
		scanf("%d", &i);
		if (i > 0 && i < 7)
		{
			switch (i)
			{
			case 1://调用银行取款函数
				system("cls");
				qukuan();
				baocun();
				break;
			case 2://调用银行存款函数
				system("cls");
				deposit();
				baocun();
				break;
			case 3:	//调用银行转账函数
				system("cls");
				transfer();
				baocun();
				break;
			case 4://调用银行余额查询函数
				system("cls");
				balance();
				break;
			case 5://调用修改密码函数
				system("cls");
				xgmm();
				baocun();
				break;
			case 6://退出
				system("cls");
				printf("谢谢使用\n");
				exit(0);
				break;
			}
		}
		else
		{
			printf("您的输入有误\n");
			system("cls");
		}
	}

}

//********************************************************************************************************************
//登录函数
void signIn()
{
	FILE* fp = fopen("D:/atm.txt", "r");
	if (fp != NULL)
	{
		while (!feof(fp))
		{
			fscanf(fp, "%s\t%s\t%s\t%s\t%s\t%f\n",
				a[j].name, a[j].idCard, a[j].username, a[j].password, a[j].tel, &a[j].money);
			j++;
		}
	}
	fclose(fp);
	for (int k = 0; k < 3; k++)
	{

		int i = 0;
		printf("请输入账号：");
		scanf_s("%s", accountId, sizeof(accountId));
		printf("请输入密码：");
		scanf_s("%s", password, sizeof(password));

		if (findAccount())
		{
			printf("登陆成功！\n");
			printf("姓名：%s\t余额：%f\n", a[x].name, a[x].money);
			showChineseMenu2();
			break;
		}
		else
		{
			if (k < 2)
				printf("账号密码错误！还有%d次机会\n", 2 - k);
		}
		if (k == 2)
			printf("您已多次错误输入密码，账号已被锁定！");
	}
}

//********************************************************************************************************************
//开户（中文）
void signUp1()
{
	printf("请输入姓名：\n");
	scanf_s("%s", a[i].name, sizeof(a[i].name));

	printf("请输入身份证：\n");
	scanf_s("%s", a[i].idCard, sizeof(a[i].idCard));

	printf("请输入账号：\n");
	scanf_s("%s", a[i].username, sizeof(a[i].username));

	printf("请输入密码：\n");
	scanf_s("%s", a[i].password, sizeof(a[i].password));

	printf("请输入电话：\n");
	scanf_s("%s", a[i].tel, sizeof(a[i].tel));

	a[i].money = 0.0f;


	FILE* fp = fopen("D:/atm.txt", "a");//存入文件（a表示追加写入）
	if (fp != NULL)
	{
		fprintf(fp, "%s\t%s\t%s\t%s\t%s\t%f\n",
			a[i].name, a[i].idCard, a[i].username, a[i].password, a[i].tel, a[i].money);
		fclose(fp);
	}

	i++;
	printf("注册成功!\n");
	printf("请继续按菜单操作\n");
}

void signUp2()//开户（英文）
{
	printf("Please enter your name：\n");
	scanf_s("%s", a[i].name, sizeof(a[i].name));

	printf("Please enter your ID number：\n");
	scanf_s("%s", a[i].idCard, sizeof(a[i].idCard));

	printf("Please enter the account number：\n");
	scanf_s("%s", a[i].username, sizeof(a[i].username));

	printf("Please input a password：\n");
	scanf_s("%s", a[i].password, sizeof(a[i].password));

	printf("Please enter your mobile number：\n");
	scanf_s("%s", a[i].tel, sizeof(a[i].tel));

	a[i].money = 0.0f;


	FILE* fp = fopen("D:/atm.txt", "a");//存入文件（a表示追加写入）
	if (fp != NULL)
	{
		fprintf(fp, "%s\t%s\t%s\t%s\t%s\t%f\n",
			a[i].name, a[i].idCard, a[i].username, a[i].password, a[i].tel, a[i].money);
		fclose(fp);
	}
	i++;

	printf("Created successfully!\n");
	printf("Please continue to press the menu\n");
}

//********************************************************************************************************************
//中文菜单1
void showChineseMenu1()
{
	printf("请选择您需要的业务：\n");      //银行业务菜单//
	printf(" ————————————————\n");
	printf(" —— 1 登录                 ——\n");
	printf(" —— 2 开户                 ——\n");
	printf(" —— 3 退出                 ——\n");
	printf(" ————————————————\n");

	while (1)
	{
		char c;
		scanf_s(" %c", &c, sizeof(c));
		system("cls");
		if (c == '1')
		{
			signIn();//登录
		}
		else if (c == '2')
		{
			signUp1();//开户
		}
		else if (c == '3')
		{
			return;//退出
		}
	}
}
//英文菜单1
void showEnglishMenu1()
{
	printf("A,log on\n");//登录
	printf("B,establish an account\n");//开户
	printf("C,logout\n");//退出

	while (1)
	{
		char c;
		scanf_s(" %c", &c, sizeof(c));
		if (c == 'A')
		{
			signIn();
		}
		else if (c == 'B')
		{
			signUp2();
		}
		else if (c == 'C')
		{
			return;
		}
	}
}

//********************************************************************************************************************

//判断账号密码是否正确，正确返回1，错误返回0
int findAccount()
{
	for (x; x <= j; x++)
	{
		if ((strcmp(accountId, a[x].username) == 0) && (strcmp(password, a[x].password) == 0))
		{
			system("cls");
			return 1;
			break;
		}
	}
	return 0; 
	
}
//修改密码函数
void xgmm()
{
	char mima1[20];
	char mima2[20];

	printf("请输入原密码：\n");
	scanf_s("%s", mima1, sizeof(mima1));
	if (strcmp(mima1, a[x].password) == 0)
	{
		printf("密码正确\n");
		printf("请输入您的新密码:\n");
		scanf_s("%s", a[x].password, sizeof(a[x].password));
		printf("修改成功！\n");
	}
	else
	{
		printf("您输入的密码与原密码不同\n");

	}
}

//********************************************************************************************************************
//余额查询
void balance()
{
	printf("\n您的余额为：%.2f\n", a[x].money);
}

//********************************************************************************************************************
//存款函数
void deposit()
{
	int n;
	printf("请输入你的存款金额(单笔存款金额不可超过2w且要为100的整数倍):\n");
	while (1)
	{
		scanf_s("%d", &n);
		if (n <= 20000 && n % 100 == 0)
		{
			a[x].money += n;
			printf("存款成功!");
			printf("\n您的余额为%.6f\n", a[x].money);
			break;
		}
		else
		{
			printf("请重新输入金额:");
		}
	}
}

//********************************************************************************************************************
//取款函数
void qukuan()
{
	int n;
	printf("请输入你的取款金额(单笔存款金额不可超过2w且要为100的整数倍):\n");
	while (1)
	{
		scanf_s("%d", &n);
		if (a[x].money >= n)
		{
			if (n <= 20000 && n % 100 == 0)
			{
				a[x].money -= n;
				printf("取款成功!");
				printf("\n您的余额为%.6f\n", a[x].money);
				break;
			}
			else
			{
				printf("请重新输入金额:");
			}
		}
		else
		{
			printf("余额不足！请重新输入：\n");
		}
	}
}


//********************************************************************************************************************
//转账
int yanzheng();//验证对方账号
void transfer()
{
	int z;
	printf("请输入对方帐号");
	char accountId[100];
	scanf("%s", accountId);
	for (z = 0; z <= j; z++)
	{
		if (strcmp(accountId, a[z].username) == 0)
		{
			system("cls");
			break;
		}

	}
	if (yanzheng())
	{
		printf("%f\t%f\n", a[x].money, a[z].money);
		printf("OK,请输入金额");
		float n=0;
		if (a[x].money >= n)
		{
			while (1)
			{
				scanf("%f", &n);
				if (n <= 20000 && int(n) % 100 == 0)
				{
					a[x].money -= n;
					a[z].money += n;
					printf("转账成功!");
					printf("\n您的余额为%.2f\n对方余额为%.2f\n", a[x].money, a[z].money);
					break;
				}
				else
				{
					printf("请重新输入金额:");
				}
			}
		}
	}
}

//验证对方帐号
int yanzheng()
{
	for (int z=0; z <= j; z++)
	{
		if (strcmp(accountId, a[z].username) == 0)
		{
			
			return 1;
		}
		
	}
	return 0;
}

//********************************************************************************************************************
//保存数据
void baocun()
{
	FILE* fp = fopen("D:/atm.txt", "w");
	if (fp != NULL)
	{
		for (int w=0;w <= j; w++)
		{
			fprintf( fp,"%s\t%s\t%s\t%s\t%s\t%.2f\n",
				a[w].name, a[w].idCard, a[w].username, a[w].password, a[w].tel, a[w].money);
		}
		printf("保存成功！");
	}
	fclose(fp);
}



