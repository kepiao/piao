#include<stdio.h>
#include <string.h>
#include<stdlib.h>//system("cls")（清屏）函数头文件
#include <cstdlib>//exit(0)（主函数之外退出程序）函数头文件

struct Account//定义账户
{   
	char name[100];//姓名
	char idCard[19];//身份证号
	char username[100];//账号
	char password[7];//密码
	char tel[12];//手机号
	float money;//余额
};

typedef struct Account Account;

Account a[100];
int i = 0;
char accountId[20], password[20];//定义一个临时数组用于存放登录时输入的账号密码
int j = 0;
int x = 0;

//判断账号密码是否正确，正确返回1，错误返回0
int findAccount( )
{
	for (x=0; x <= j; x++)
	{
		if (( strcmp(accountId, a[x].username) == 0) && strcmp(password, a[x].password) == 0)
		{
			system("cls");
			return 1;
		}
		else
		{
			return 0;
		}
	}
}
//修改密码函数
void xgmm()
{
	char mima1[20];
	char mima2[20];
	
	printf("请输入原密码：\n");
	scanf_s("%s", mima1, sizeof(mima1));
	if (strcmp(mima1,a[x].password)==0)
	{
		printf("密码正确\n"); 
		printf("请输入您的新密码:\n");
		scanf_s("%s", mima2, sizeof(mima2));
		

	}
	else
	{
		printf("您输入的密码与原密码不同\n");
		
	}
}

//中文菜单2
void showChineseMenu2()
{
	int i;      //i为客户选择输入的变量
	while (1)
	{
		printf("请选择您需要的业务\n");      //银行业务菜单
		printf(" ——————————————————\n");
		printf(" —— 1 取款      ——2 存款     ——\n");
		printf(" ——————————————————\n");
		printf(" —— 3 转账      ——4 余额查询 ——\n");
		printf(" ——————————————————\n");
		printf(" —— 5 修改密码  ——6 退出     ——\n");
		printf(" ——————————————————\n");
		scanf("%d", &i);
		if (i > 0 && i < 7)
		{
			switch (i)
			{
			case 1://调用银行取款函数
				system("cls");
				
				break;
			case 2://调用银行存款函数
				system("cls");
				
				break;
			case 3:	//调用银行转账函数
				system("cls");
				break;
			case 4://调用银行余额查询函数
				system("cls");
				xgmm();
				break;
			case 5://调用修改密码函数
				system("cls");
				xgmm();
				break;
			case 6://退出
				system("cls");
				printf("谢谢使用\n");
				exit(0);
				break;
			}
		}
		else
		{
			printf("您的输入有误\n");
			system("cls");
		}
	}

}



//登录函数
void signIn()
{
	FILE* fp = fopen("D:/atm.txt", "r");
	if (fp != NULL)
	{
		while (!feof(fp))
		{
			fscanf(fp,"%s\t%s\t%s\t%s\t%s\n",
				a[j].name, a[j].idCard, a[j].username, a[j].password, a[j].tel);
			j++;
		}
	}
	for (int k = 0; k < 3; k++)
	{
		
		int i = 0;
		printf("请输入账号：");
		scanf_s("%s", accountId, sizeof(accountId));
		printf("请输入密码：");
		scanf_s("%s", password, sizeof(password));
		
		
		if (findAccount())
		{
			printf("登陆成功！");
			printf(" % s\t % s\t % s\t % s\t % s\n",
				a[x].name, a[x].idCard, a[x].username, a[x].password, a[x].tel);
			showChineseMenu2();
			break;
		}
		else
		{
			if(k<2)
			printf("账号密码错误！还有%d次机会\n",2-k);
		}
		if (k == 2)
			printf("您已多次错误输入密码，账号已被锁定！");
	}


}


void signUp1()//开户（中文）
{
	printf("请输入姓名：\n");
	scanf_s("%s", a[i].name, sizeof(a[i].name));

	printf("请输入身份证：\n");
	scanf_s("%s", a[i].idCard, sizeof(a[i].idCard));

	printf("请输入账号：\n");
	scanf_s("%s", a[i].username, sizeof(a[i].username));

	printf("请输入密码：\n");
	scanf_s("%s", a[i].password, sizeof(a[i].password));

	printf("请输入电话：\n");
	scanf_s("%s", a[i].tel, sizeof(a[i].tel));

	a[i].money = 0.0f;
	

	FILE* fp = fopen("D:/atm.txt", "a");//存入文件（a表示追加写入）
	if (fp != NULL)
	{
		fprintf(fp, "%s\t%s\t%s\t%s\t%s\n",
			a[i].name, a[i].idCard, a[i].username, a[i].password, a[i].tel);
		fclose(fp);
	}

	i++;
	printf("注册成功!\n");
	printf("请继续按菜单操作\n");
}

void signUp2()//开户（英文）
{
	printf("Please enter your name：\n");
	scanf_s("%s", a[i].name, sizeof(a[i].name));

	printf("Please enter your ID number：\n");
	scanf_s("%s", a[i].idCard, sizeof(a[i].idCard));

	printf("Please enter the account number：\n");
	scanf_s("%s", a[i].username, sizeof(a[i].username));

	printf("Please input a password：\n");
	scanf_s("%s", a[i].password, sizeof(a[i].password));

	printf("Please enter your mobile number：\n");
	scanf_s("%s", a[i].tel, sizeof(a[i].tel));

	a[i].money = 0.0f;


	FILE* fp = fopen("D:/atm.txt", "a");//存入文件（a表示追加写入）
	if (fp != NULL)
	{
		fprintf(fp, "%s\t%s\t%s\t%s\t%s\n",
			a[i].name, a[i].idCard, a[i].username, a[i].password, a[i].tel);
		fclose(fp);
	}
	i++;

	printf("Created successfully!\n");
	printf("Please continue to press the menu\n");
}

void printAllAccount()//打印所有账户
{
	for (int j = 0; j < i; j++)
	{
		printf("%s\t%s\n", a[j].name, a[j].username);
	}
}
//中文菜单1
void showChineseMenu1()
{
	printf("请选择您需要的业务：\n");      //银行业务菜单//
	printf(" ————————————————\n");
	printf(" —— 1 登录                 ——\n");
	printf(" —— 2 开户                 ——\n");
	printf(" —— 3 退出                 ——\n");
	printf(" ————————————————\n");

	while (1)
	{
		char c;
		scanf_s(" %c", &c, sizeof(c));
		system("cls");
		if (c == '1')
		{
			signIn();//登录
		}
		else if (c == '2')
		{
			signUp1();//开户
		}
		else if (c == '3')
		{
			return;//退出
		}
		else if (c == '9')
		{
			printAllAccount();
		}
	}
}
//英文菜单1
void showEnglishMenu1()
{
	printf("A,log on\n");//登录
	printf("B,establish an account\n");//开户
	printf("C,logout\n");//退出

	while (1)
	{
		char c;
		scanf_s(" %c", &c, sizeof(c));
		if (c == 'A')
		{
			signIn();
		}
		else if (c == 'B')
		{
			signUp2();
		}
		else if (c == 'C')
		{
			return;
		}
	}
}

int main()
{
	printf("*****************************\n");
	printf("**欢迎使用ATM自动取款机系统**\n");
	printf("*****************************\n");
	printf("——————————————\n");
	printf("|      按1,显示中文       |\n");
	printf("——————————————\n");
	printf("|    Input 2,Show English   |\n");
	printf("——————————————\n");

	char c;
	scanf_s("%c", &c, sizeof(c));
	system("cls");
	if (c == '1')
	{
		//显示中文菜单 
		showChineseMenu1();
	}
	else if (c == '2')
	{
		//显示英文菜单 
		showEnglishMenu1();
	}
	return 0;
}
